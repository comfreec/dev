<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸</title>
</head>
<body>
    <h1>ê¸€ì ì¸ì‹ í…ŒìŠ¤íŠ¸</h1>
    
    <canvas id="test-canvas" width="300" height="300" style="border: 2px solid black; cursor: crosshair;"></canvas>
    <br><br>
    
    <button onclick="testRecognize()">ê¸€ì í™•ì¸</button>
    <button onclick="clearTestCanvas()">ì§€ìš°ê¸°</button>
    
    <div id="result" style="margin-top: 20px; font-size: 24px; font-weight: bold;"></div>

    <script>
        const testCanvas = document.getElementById('test-canvas');
        const testCtx = testCanvas.getContext('2d');
        let isDrawing = false;

        testCtx.lineWidth = 5;
        testCtx.lineCap = 'round';
        testCtx.strokeStyle = 'blue';

        // ê·¸ë¦¬ê¸° ì´ë²¤íŠ¸
        testCanvas.addEventListener('mousedown', startDraw);
        testCanvas.addEventListener('mousemove', draw);
        testCanvas.addEventListener('mouseup', stopDraw);

        function startDraw(e) {
            isDrawing = true;
            draw(e);
        }

        function draw(e) {
            if (!isDrawing) return;
            
            const rect = testCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            testCtx.lineTo(x, y);
            testCtx.stroke();
            testCtx.beginPath();
            testCtx.moveTo(x, y);
        }

        function stopDraw() {
            if (isDrawing) {
                isDrawing = false;
                testCtx.beginPath();
                
                // ìë™ ì¸ì‹ (0.5ì´ˆ í›„)
                setTimeout(() => {
                    testRecognize();
                }, 500);
            }
        }

        function testRecognize() {
            console.log('testRecognize í˜¸ì¶œë¨');
            
            const result = document.getElementById('result');
            
            // ê·¸ë¦¼ì´ ìˆëŠ”ì§€ í™•ì¸
            const imageData = testCtx.getImageData(0, 0, testCanvas.width, testCanvas.height);
            let hasDrawing = false;
            
            for (let i = 0; i < imageData.data.length; i += 4) {
                if (imageData.data[i + 3] > 0) {
                    hasDrawing = true;
                    break;
                }
            }
            
            if (!hasDrawing) {
                result.textContent = 'ê¸€ìë¥¼ ê·¸ë ¤ë³´ì„¸ìš”!';
                result.style.color = 'orange';
                return;
            }
            
            // ëœë¤ ê²°ê³¼
            const success = Math.random() > 0.3;
            
            if (success) {
                result.textContent = 'ë§ì·„ìŠµë‹ˆë‹¤! ğŸ‰';
                result.style.color = 'green';
                
                // ìŒì„±
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance('ë§ì·„ìŠµë‹ˆë‹¤');
                    utterance.lang = 'ko-KR';
                    speechSynthesis.speak(utterance);
                }
            } else {
                result.textContent = 'í‹€ë ¸ìŠµë‹ˆë‹¤! ğŸ’ª';
                result.style.color = 'red';
                
                // ìŒì„±
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance('í‹€ë ¸ìŠµë‹ˆë‹¤');
                    utterance.lang = 'ko-KR';
                    speechSynthesis.speak(utterance);
                }
            }
        }

        function clearTestCanvas() {
            testCtx.clearRect(0, 0, testCanvas.width, testCanvas.height);
            document.getElementById('result').textContent = '';
        }
    </script>
</body>
</html>